<!DOCTYPE html>
<html>

<head>
    <title>Setup</title>

    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">
    <script src="vendor/jquery/jquery.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/web3/web3.min.js"></script>
    <script src="js/env.js"></script>
    <script src="js/web3.min.js"></script>
    <script src="js/walletconnect_v2.js"></script>
    <script src="js/web3-providers-http.min.js"></script>
</head>

<body class="mb-5">
    <section id="divNavPage"></section>
    <section id="setup" class="container mt-5" style="max-width: 540px;">
        <div class="alert d-none" role="alert" id="divStatus">
        </div>
        <div class="card">
            <div class="card-body">
                <div class="mb-3">
                    <label for="ddlChain" class="form-label">Chain</label>
                    <select id="ddlChain" class="form-select" aria-label="Default select example">
                        <option selected>Select</option>
                        <option value="84532">Base Sepolia</option>
                        <option value="59144">Linea Sepolia</option>
                        <option value="11155420">Optimism Sepolia</option>
                        <option value="11155111">Sepolia</option>
                        <option value="534351">Scroll Sepolia</option>
                        <option value="48899">Zircuit</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="txtProjectType" class="form-label">Project Name</label>
                    <input class="form-control" id="txtProjectType">
                </div>
                <div class="mb-3">
                    <label for="txtRewardType" class="form-label">Reward Type</label>
                    <input class="form-control" id="txtRewardType">
                </div>
                <div class="mb-3">
                    <label for="txtRules" class="form-label">Scoring Rules</label>
                    <input class="form-control" id="txtRules">
                </div>
                <div id="walletSection">
                    <button id="btnWalletConnect_v2" type="button" onclick="connectWeb3('WalletConnect_v2')"
                        class="btn btn-white d-flex justify-content-between align-items-center w-100 p-3 mb-2"
                        style="border: 2px solid blue;">
                        <span class="text-dark">WalletConnect</span>
                        <img width="25" src="./images/walletconnect.svg" alt="">
                    </button>
                </div>
                <div id="lblWallet">
                </div>
                <div class="mb-3">
                    <button id="btnSetup" class="btn btn-primary">Deploy</button>
                </div>
            </div>
        </div>
    </section>

    <section id="interact" class="container mt-5 d-none" style="max-width: 540px;" visible="false">
        <div class="alert d-none" role="alert" id="divStatus2">
        </div>
        <div class="card">
            <div class="card-body">
                <div class="mb-3">
                    <label for="" class="form-label">Contract Address</label>
                    <a href="javascript:;" id="linkContractAddress" target="_blank"><span class="form-control"
                            id="txtContractAddress">&nbsp;</span></a>
                </div>
                <div class="mb-3">
                    <label for="txtBlockData" class="form-label">Data</label>
                    <textarea class="form-control" id="txtBlockData"></textarea>
                </div>
                <div class="mb-3">
                    <button id="btnSubmit" class="btn btn-primary">Send</button>
                </div>
            </div>
        </div>
    </section>

    <div id="reward" class="mt-5 d-none">
        <section class="d-flex justify-content-center" style="max-width: 100%;">
            <iframe title="BuddyBuddy" width="900" height="373.5"
                src="https://app.powerbi.com/view?r=eyJrIjoiOTNmODJiMGQtODUzMS00MGNmLWE2ZTAtMDVhYzU5NTRiYmJmIiwidCI6ImRjNjE0YmZkLTQzOGYtNDcyNi1hMmM2LTNmN2QzZDllZWIxYyIsImMiOjEwfQ%3D%3D"
                frameborder="0" allowFullScreen="true"></iframe>
        </section>

        <section class="container mt-5" style="max-width: 540px;">
            <div class="alert d-none" role="alert" id="divStatus3">
            </div>
            <div class="card">
                <div class="card-header">
                    Reward <span id="rewardType"></span>
                </div>

                <div class="card-body">
                    <div class="mb-3">
                        <label for="txtName" class="form-label">Name</label>
                        <input class="form-control" id="txtName">
                    </div>
                    <div class="mb-3">
                        <label for="txtSymbol" class="form-label">Symbol</label>
                        <input class="form-control" id="txtSymbol">
                    </div>
                    <div class="mb-3">
                        <label for="txtMaxSupply" class="form-label">maxSupply</label>
                        <input class="form-control" id="txtMaxSupply">
                    </div>
                    <div class="mb-3">
                        <button id="btnCreate" class="btn btn-primary me-2">Create</button>
                        <button id="btnDistribute" class="btn btn-primary me-2">Distribute</button>
                    </div>
                    <div class="mb-3">
                        <button id="btnDistributeUSDC" class="btn btn-primary me-2">Distribute Circle USDC </button>
                        <!-- <button id="btnSubmit2" class="btn btn-primary mr-2">Send2</button>
                        <button id="btnSubmit3" class="btn btn-primary mr-2">Send3</button> -->
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>

<script src="js/master.js"></script>
<script>
    var walletObj;
    var walletConnectObj_v2;

    // walletConnect related variable - Create these earlier so we can hook "disconnect" event
    var WalletConnectProvider_v2 = window["@walletconnect/ethereum-provider"].EthereumProvider;

    let web3obj;
    // Web3modal instance
    let web3Modal;
    // Chosen wallet provider given by the dialog window
    let provider;

    let section_setup = document.getElementById('setup');
    let section_interact = document.getElementById('interact');
    let section_reward = document.getElementById('reward');

    async function deployContract(event) {
        event.preventDefault();

        var divStatus = document.getElementById('divStatus');
        try {
            // Deploy the contract
            const contractABI = [{ "inputs": [{ "internalType": "string", "name": "_projectName", "type": "string" }, { "internalType": "string", "name": "_rewardType", "type": "string" }, { "internalType": "string", "name": "_scoringRules", "type": "string" }], "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "writer", "type": "address" }, { "indexed": true, "internalType": "uint256", "name": "blobId", "type": "uint256" }, { "indexed": false, "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }], "name": "BlobWritten", "type": "event" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "blobById", "outputs": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "blobs", "outputs": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getEventPeriod", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getRecurringCount", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getScoringRules", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "projectName", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "blobId", "type": "uint256" }], "name": "readBlobById", "outputs": [{ "components": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "internalType": "struct BuddyBuddy.BlobData", "name": "", "type": "tuple" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "readLatestBlob", "outputs": [{ "components": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "internalType": "struct BuddyBuddy.BlobData", "name": "", "type": "tuple" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "rewardType", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "_eventPeriod", "type": "uint256" }], "name": "setEventPeriod", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "_recurringCount", "type": "uint256" }], "name": "setRecurringCount", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "string", "name": "_scoringRules", "type": "string" }], "name": "setScoringRules", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }], "name": "writeBlobData", "outputs": [], "stateMutability": "nonpayable", "type": "function" }];
            const bytecode = '60806040523480156200001157600080fd5b5060405162000bac38038062000bac83398101604081905262000034916200012f565b60006200004284826200024f565b5060016200005183826200024f565b5060026200006082826200024f565b505050506200031b565b634e487b7160e01b600052604160045260246000fd5b600082601f8301126200009257600080fd5b81516001600160401b0380821115620000af57620000af6200006a565b604051601f8301601f19908116603f01168101908282118183101715620000da57620000da6200006a565b81604052838152602092508683858801011115620000f757600080fd5b600091505b838210156200011b5785820183015181830184015290820190620000fc565b600093810190920192909252949350505050565b6000806000606084860312156200014557600080fd5b83516001600160401b03808211156200015d57600080fd5b6200016b8783880162000080565b945060208601519150808211156200018257600080fd5b620001908783880162000080565b93506040860151915080821115620001a757600080fd5b50620001b68682870162000080565b9150509250925092565b600181811c90821680620001d557607f821691505b602082108103620001f657634e487b7160e01b600052602260045260246000fd5b50919050565b601f8211156200024a57600081815260208120601f850160051c81016020861015620002255750805b601f850160051c820191505b81811015620002465782815560010162000231565b5050505b505050565b81516001600160401b038111156200026b576200026b6200006a565b62000283816200027c8454620001c0565b84620001fc565b602080601f831160018114620002bb5760008415620002a25750858301515b600019600386901b1c1916600185901b17855562000246565b600085815260208120601f198616915b82811015620002ec57888601518255948401946001909101908401620002cb565b50858210156200030b5787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b610881806200032b6000396000f3fe608060405234801561001057600080fd5b50600436106100cf5760003560e01c80636a39a48f1161008c578063c89e2e0e11610066578063c89e2e0e146101ac578063cb1ee57f146101d3578063d38d0a92146101db578063ddac017d146101e357600080fd5b80636a39a48f1461017c5780639a33e30014610184578063a5d386601461019957600080fd5b806320c0b630146100d45780632abc3d4e146100eb5780632f4db4c1146101135780635bfb69f7146101285780636353f8db1461013b578063692642e714610169575b600080fd5b6004545b6040519081526020015b60405180910390f35b6100fe6100f9366004610597565b6101eb565b604080519283526020830191909152016100e2565b610126610121366004610597565b600355565b005b6101266101363660046105c6565b610219565b61014e610149366004610597565b610229565b604080518251815260209283015192810192909252016100e2565b610126610177366004610597565b600455565b61014e6102da565b61018c610387565b6040516100e29190610677565b6101266101a7366004610597565b610415565b6100fe6101ba366004610597565b6006602052600090815260409020805460019091015482565b61018c6104f8565b61018c61058a565b6003546100d8565b600581815481106101fb57600080fd5b60009182526020909120600290910201805460019091015490915082565b6002610225828261074e565b5050565b604080518082019091526000808252602082015260055482106102935760405162461bcd60e51b815260206004820152601760248201527f426c6f6220494420646f6573206e6f742065786973742e00000000000000000060448201526064015b60405180910390fd5b600582815481106102a6576102a661080e565b9060005260206000209060020201604051806040016040529081600082015481526020016001820154815250509050919050565b60408051808201909152600080825260208201526005546103355760405162461bcd60e51b8152602060048201526015602482015274273790313637b139903bb934ba3a32b7103cb2ba1760591b604482015260640161028a565b6005805461034590600190610824565b815481106103555761035561080e565b906000526020600020906002020160405180604001604052908160008201548152602001600182015481525050905090565b60008054610394906106c5565b80601f01602080910402602001604051908101604052809291908181526020018280546103c0906106c5565b801561040d5780601f106103e25761010080835404028352916020019161040d565b820191906000526020600020905b8154815290600101906020018083116103f057829003601f168201915b505050505081565b6040805180820190915281815242602082019081526005805460018082018355600083815285517f036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db060029094029384015593517f036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db190920191909155905461049c9190610824565b60008181526006602090815260409182902085518155858201516001909101559051858152919250829133917ff07ddd471575abbdec8064fae85f06ea8cf8716f6d1b281ffb086fa3ce4e77e9910160405180910390a3505050565b606060028054610507906106c5565b80601f0160208091040260200160405190810160405280929190818152602001828054610533906106c5565b80156105805780601f1061055557610100808354040283529160200191610580565b820191906000526020600020905b81548152906001019060200180831161056357829003601f168201915b5050505050905090565b60018054610394906106c5565b6000602082840312156105a957600080fd5b5035919050565b634e487b7160e01b600052604160045260246000fd5b6000602082840312156105d857600080fd5b813567ffffffffffffffff808211156105f057600080fd5b818401915084601f83011261060457600080fd5b813581811115610616576106166105b0565b604051601f8201601f19908116603f0116810190838211818310171561063e5761063e6105b0565b8160405282815287602084870101111561065757600080fd5b826020860160208301376000928101602001929092525095945050505050565b600060208083528351808285015260005b818110156106a457858101830151858201604001528201610688565b506000604082860101526040601f19601f8301168501019250505092915050565b600181811c908216806106d957607f821691505b6020821081036106f957634e487b7160e01b600052602260045260246000fd5b50919050565b601f82111561074957600081815260208120601f850160051c810160208610156107265750805b601f850160051c820191505b8181101561074557828155600101610732565b5050505b505050565b815167ffffffffffffffff811115610768576107686105b0565b61077c8161077684546106c5565b846106ff565b602080601f8311600181146107b157600084156107995750858301515b600019600386901b1c1916600185901b178555610745565b600085815260208120601f198616915b828110156107e0578886015182559484019460019091019084016107c1565b50858210156107fe5787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b634e487b7160e01b600052603260045260246000fd5b8181038181111561084557634e487b7160e01b600052601160045260246000fd5b9291505056fea26469706673582212202ae2fbd24b257a9ef863381a1d42fdc6e55841bee4345fce272f4dc1da13468e64736f6c63430008130033';
            const contract = new web3obj.eth.Contract(contractABI);
            const accounts = await web3obj.eth.getAccounts();

            // Ensure you have the correct values for your contract's constructor parameters
            const projectType = document.getElementById('txtProjectType').value;
            const rewardType = document.getElementById('txtRewardType').value;
            const rules = document.getElementById('txtRules').value;
            const valueChain = document.getElementById('ddlChain').value;

            const deployedContract = await contract.deploy({
                data: bytecode,
                arguments: [projectType, rewardType, rules] // Pass constructor parameters directly here
            }).send({
                from: accounts[0], // Use the first account to deploy
                gas: 2000000, // Adjust the gas limit as necessary
                gas: 2000000, // Adjust the gas limit as necessary
                // Note: The gas value you provided was quite high; adjust it according to your contract's needs
            });

            var deployContractUrl;
            // if (valueChain == "Base Sepolia") {
            //     deployContractUrl = "https://sepolia.basescan.org/address/" + deployedContract.options.address + "#code"
            // }
            // deployContractUrl = "https://sepolia.basescan.org/address/" + deployedContract.options.address + "#code"
            deployContractUrl = "https://sepolia.etherscan.io/address/" + deployedContract.options.address + "#code"


            // After deployment, the deployed contract instance contains the address
            console.log('Contract deployed at address:', deployedContract.options.address);
            divStatus.innerHTML = 'Contract deployed at address:' + deployedContract.options.address;
            divStatus.classList.add('alert-success');

            document.getElementById("linkContractAddress").href = deployContractUrl;
            document.getElementById("txtContractAddress").innerHTML = deployedContract.options.address;
        } catch (error) {
            console.error('Error deploying contract:', error);
            divStatus.innerHTML = 'Error deploying contract:' + error;
            divStatus.classList.add('alert-danger')
        }
        divStatus.classList.remove('d-none')
    }

    document.getElementById("btnSetup").addEventListener("click", deployContract);

    async function exitProvider() {
        if (provider) {
            await provider.close();
            // If the cached provider is not cleared,
            // WalletConnect will default to the existing session
            // and does not allow to re-scan the QR code with a new wallet.
            // Depending on your use case you may want or want not his behavir.
            await web3Modal.clearCachedProvider();
            provider = null;
            window.location.reload(true);
        }
    }

    async function initWalletConnect_v2() {
        walletConnectObj_v2 = await WalletConnectProvider_v2.init({
            projectId: 'ad2cbbc1810a6036a4c3c0c8042073c3', // REQUIRED your projectId
            chains: [document.getElementById('ddlChain').value],
            //chains: [11155111],
            showQrModal: true,
            rpcMap:
            {
                '1': 'https://1rpc.io/eth',
                '84532': 'https://sepolia.base.org',
                '17000': 'https://ethereum-holesky.publicnode.com',
                '11155111': 'https://1rpc.io/sepolia',
                '11155420': 'https://sepolia.optimism.io',
                '534351': 'https://sepolia-rpc.scroll.io',
                '48899': 'https://zircuit1.p2pify.com',
                '59144': 'https://rpc.linea.build'
            }
        });
    }

    async function getWeb3Accounts() {
        try {
            const accounts = await web3obj.eth.getAccounts();

            if (accounts.length > 0) {
                const address = accounts[0];
                const isAddress = web3obj.utils.isAddress(address);

                if (isAddress) {
                    // Assuming isAccount is meant to be used elsewhere
                    isAccount = true; // Ensure this variable is declared and managed properly elsewhere
                    return address; // Returns the first account if it's a valid address
                } else {
                    alert('Retrieved address is not valid.');
                    return null; // Handle invalid address case
                }
            } else {
                alert('Please connect to your Web3 provider!');
                return null; // Handle no accounts case
            }
        } catch (err) {
            alert(err + '. Are you sure you are on a secure (SSL / HTTPS) connection?');
            throw err; // Rethrow or handle the error as needed
        }
    }


    async function connectWeb3(type) {
        var cont = false;
        try {

            await initWalletConnect_v2();

            var walletConnectEnableTask = walletConnectObj_v2.connect();
            await walletConnectEnableTask;

            walletConnectObj_v2.on('disconnect', function (error, payload) {
                window.location.reload(true)
            });

            web3obj = new Web3(walletConnectObj_v2);
            nonBrowserWallet = true;
            typeOfLogin = type;

        } catch (err) {
            console.log('Error from Web3Modal: ' + err);
            alert('Failed to establish a connection to ' + type + '.');
            var isInIFrame = (window.location != window.parent.location);
            if (isInIFrame) {
                var element = window.parent.document.getElementById("writecontractiframe");
                element.style.removeProperty("min-height");
            }
            // await resetPage();
            return;
        }

        if (typeof web3obj !== 'undefined') {
            var network = 0;

            getWeb3Accounts().then(accounts => {
                console.log('Retrieved accounts:', accounts);
                // Use the accounts here

                var isAddress = web3obj.utils.isAddress(accounts);
                divWallet = document.getElementById('walletSection');
                // To hide the element
                divWallet.style.display = "none";

                lblWallets = document.getElementById('lblWallet');
                lblWallets.innerHTML = '<label for="address" class="form-label">Connected: <span style="height: 10px; width: 10px; background-color: green; border-radius: 50%; display: inline-block; margin-left: 5px;"></span> ' + accounts + '</label>';


            }).catch(error => {
                console.error('Failed to retrieve accounts:', error);
                // Handle the error here, e.g., user denied account access
            });
            // network = await web3obj.eth.net.getId();
            // netID = network.toString();
            // network = getChainId(netID);

        } else {
            alert('Unable to locate a compatible web3 browser!');
        }
    }

    // Function to send transaction to the contract
    async function sendTransaction(event) {
        event.preventDefault();
        const contractABI2 = [{ "inputs": [{ "internalType": "string", "name": "_projectName", "type": "string" }, { "internalType": "string", "name": "_rewardType", "type": "string" }, { "internalType": "string", "name": "_scoringRules", "type": "string" }], "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "writer", "type": "address" }, { "indexed": true, "internalType": "uint256", "name": "blobId", "type": "uint256" }, { "indexed": false, "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }], "name": "BlobWritten", "type": "event" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "blobById", "outputs": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "blobs", "outputs": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getEventPeriod", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getRecurringCount", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "getScoringRules", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "projectName", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "blobId", "type": "uint256" }], "name": "readBlobById", "outputs": [{ "components": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "internalType": "struct BuddyBuddy.BlobData", "name": "", "type": "tuple" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "readLatestBlob", "outputs": [{ "components": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }, { "internalType": "uint256", "name": "timestamp", "type": "uint256" }], "internalType": "struct BuddyBuddy.BlobData", "name": "", "type": "tuple" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "rewardType", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "_eventPeriod", "type": "uint256" }], "name": "setEventPeriod", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "_recurringCount", "type": "uint256" }], "name": "setRecurringCount", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "string", "name": "_scoringRules", "type": "string" }], "name": "setScoringRules", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "bytes32", "name": "blobHash", "type": "bytes32" }], "name": "writeBlobData", "outputs": [], "stateMutability": "nonpayable", "type": "function" }];
        const contractAddress = document.getElementById("txtContractAddress").innerHTML; // Update with your contract address
        // Get the contract instance
        const contract = new web3obj.eth.Contract(contractABI2, contractAddress);

        var divStatus = document.getElementById('divStatus2')
        try {
            // Get the input value from the form
            const inputValue = document.getElementById("txtBlockData").value;
            let hex = web3.utils.asciiToHex(inputValue, 64);

            // Pad the string to make it 32 bytes long
            let paddedHex = Web3.utils.padLeft(hex);; // 64 hex characters = 32 bytes

            if (paddedHex.length > 66) {
                paddedHex = paddedHex.slice(0, 66);
            }

            // Send transaction to the contract function
            const accounts = await web3obj.eth.getAccounts();
            await contract.methods.writeBlobData(paddedHex).send({
                from: accounts[0], // Update with the account you want to send from
                gas: 1500000 // Adjust gas value as needed
            });

            console.log('Transaction sent successfully');
            divStatus.innerHTML = 'Transaction sent successfully'
            divStatus.classList.add('alert-success')
        } catch (error) {
            console.error('Error sending transaction:', error);
            divStatus.innerHTML = 'Error sending transaction:' + error;
            divStatus.classList.add('alert-danger')
        }
        divStatus.classList.remove('d-none')
    }

    document.getElementById("btnSubmit").addEventListener("click", sendTransaction);

    // // Attach event listener to the form submission
    // var divStatus = document.getElementById('divStatus3')
    // divStatus.classList.add('alert-success')

    // var divStatus = document.getElementById('divStatus3')
    // const txtMaxSupply = document.getElementById("txtMaxSupply").value;
    // divStatus.innerHTML = 'Address: <a target="_blank" href="sepolia.etherscan.io/token/0x002e6eb34b122788a08038e1bd3e36e8ec4e6a2c"</a>';
    // divStatus.classList.remove('d-none')

    var blockNumber = 0
    var txhash = ""
    var count = 0

    async function executeReward(event) {
        event.preventDefault();

        var divStatus = document.getElementById('divStatus3')
        try {

            $.ajax({
                url: mintclub_url, // URL of the API endpoint
                method: 'GET', // HTTP method
                data: {
                    name: document.getElementById("txtName").value,
                    symbol: document.getElementById("txtSymbol").value,
                    maxSupply: document.getElementById("txtMaxSupply").value,
                    chainid: document.getElementById('ddlChain').value
                }, // Pass parameters here
                success: function (res) {
                    setTimeout(function() {
                        $.ajax({
                            url: chainlist[document.getElementById('ddlChain').value]
    .api + '?module=proxy&action=eth_blockNumber&apikey=YourApiKeyToken',
                            method: 'GET',
                            dataType: 'json',
                            success: function(response) {
                                // Handle the response data
                                blockNumber = parseInt(response.result, 16)
                                console.log('Response block data:', blockNumber);
                                setTimeout(function() {
                                    getTx()
                                }, 6000);
                            },
                            error: function(xhr, status, error) {
                                // Handle errors
                                console.error('Request failed with status:', xhr.status);
                                divStatus.innerHTML = 'Request failed with status:' + error;
                                divStatus.classList.add('alert-danger')
                                divStatus.classList.remove('d-none')
                            }
                        });
                    }, 6000);
                },
                error: function (xhr, status, error) {
                    // Callback function to handle errors
                    console.error('Error:', error);
                    divStatus.innerHTML = 'Error:' + error;
                    divStatus.classList.add('alert-danger')
                    divStatus.classList.remove('d-none')
                }
            });
        } catch (error) {
            console.error('Error deploying contract:', error);
            divStatus.innerHTML = 'Error:' + error;
            divStatus.classList.add('alert-danger')
            divStatus.classList.remove('d-none')
        }
    }


    function getTx() {
        var divStatus = document.getElementById('divStatus3')
        $.ajax({
            url: chainlist[document.getElementById('ddlChain').value]
                .api + '?module=account&action=txlist&address=0x1671aad14B578C74259b682fac2111845BD0964D&startblock=' + blockNumber + '&endblock=99999999&page=1&offset=10&sort=asc&apikey=YourApiKeyToken',
            method: 'GET',
            dataType: 'json',
            success: function (response) {
                // Handle the response data
                console.log('Response getTx data:', response);

                var result = response.result
                if (result.length > 0) {
                    if (blockNumber < response.result[0].blockNumber && response.result[0].from == "0x1671aad14b578c74259b682fac2111845bd0964d" && response.result[0].to == "0x8dce343a86aa950d539eee0e166affd0ef515c0c") {
                        setTimeout(function () {
                            txhash = response.result[0].hash
                            getInternalTx()
                        }, 6000);
                    } else {
                        if (count < 20) {
                            count += 1
                            setTimeout(function () {
                                getTx()
                            }, 6000);
                        } else {
                            count = 0
                            console.error('Fail');
                            divStatus.innerHTML = 'Fail'
                            divStatus.classList.add('alert-danger')
                            divStatus.classList.remove('d-none')
                        }
                    }
                }
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Request failed with status:', xhr.status);
                divStatus.innerHTML = 'Request failed with status:' + error;
                divStatus.classList.add('alert-danger')
                divStatus.classList.remove('d-none')
            }
        });
    }

    function getInternalTx(){
        $.ajax({
            url: chainlist[document.getElementById('ddlChain').value]
                .api + '?module=account&action=txlistinternal&txhash=' + txhash + '&apikey=YourApiKeyToken',
            method: 'GET',
            dataType: 'json',
            success: function (response) {
                // Handle the response data
                console.log('Response getInternalTx data:', response);

                var result = response.result
                if (result.length > 0) {
                    console.log('Address: ' + result[0].contractaddress);
                    // console.log('Address:0x002e6eb34b122788a08038e1bd3e36e8ec4e6a2c', res);
                    divStatus.innerHTML = 'Address: ' + result[0].contractAddress;
                    divStatus.classList.add('alert-success')
                    divStatus.classList.remove('d-none')
                }
            },
            error: function (xhr, status, error) {
                // Handle errors
                console.error('Request failed with status:', xhr.status);
                console.error('Request failed with status:', xhr.status);
                divStatus.innerHTML = 'Request failed with status:' + error;
                divStatus.classList.add('alert-danger')
                divStatus.classList.remove('d-none')
            }
        });
    }

    async function distributeReward(event) {
        event.preventDefault();

        var divStatus = document.getElementById('divStatus3')
        const contractABI3 = [{ "inputs": [{ "internalType": "address", "name": "sender", "type": "address" }, { "internalType": "uint256", "name": "balance", "type": "uint256" }, { "internalType": "uint256", "name": "needed", "type": "uint256" }, { "internalType": "uint256", "name": "tokenId", "type": "uint256" }], "name": "ERC1155InsufficientBalance", "type": "error" }, { "inputs": [{ "internalType": "address", "name": "approver", "type": "address" }], "name": "ERC1155InvalidApprover", "type": "error" }, { "inputs": [{ "internalType": "uint256", "name": "idsLength", "type": "uint256" }, { "internalType": "uint256", "name": "valuesLength", "type": "uint256" }], "name": "ERC1155InvalidArrayLength", "type": "error" }, { "inputs": [{ "internalType": "address", "name": "operator", "type": "address" }], "name": "ERC1155InvalidOperator", "type": "error" }, { "inputs": [{ "internalType": "address", "name": "receiver", "type": "address" }], "name": "ERC1155InvalidReceiver", "type": "error" }, { "inputs": [{ "internalType": "address", "name": "sender", "type": "address" }], "name": "ERC1155InvalidSender", "type": "error" }, { "inputs": [{ "internalType": "address", "name": "operator", "type": "address" }, { "internalType": "address", "name": "owner", "type": "address" }], "name": "ERC1155MissingApprovalForAll", "type": "error" }, { "inputs": [], "name": "MCV2_MultiToken__AlreadyInitialized", "type": "error" }, { "inputs": [], "name": "MCV2_MultiToken__BurnAmountExceedsTotalSupply", "type": "error" }, { "inputs": [], "name": "MCV2_MultiToken__NotApproved", "type": "error" }, { "inputs": [], "name": "MCV2_MultiToken__PermissionDenied", "type": "error" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "account", "type": "address" }, { "indexed": true, "internalType": "address", "name": "operator", "type": "address" }, { "indexed": false, "internalType": "bool", "name": "approved", "type": "bool" }], "name": "ApprovalForAll", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "operator", "type": "address" }, { "indexed": true, "internalType": "address", "name": "from", "type": "address" }, { "indexed": true, "internalType": "address", "name": "to", "type": "address" }, { "indexed": false, "internalType": "uint256[]", "name": "ids", "type": "uint256[]" }, { "indexed": false, "internalType": "uint256[]", "name": "values", "type": "uint256[]" }], "name": "TransferBatch", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": true, "internalType": "address", "name": "operator", "type": "address" }, { "indexed": true, "internalType": "address", "name": "from", "type": "address" }, { "indexed": true, "internalType": "address", "name": "to", "type": "address" }, { "indexed": false, "internalType": "uint256", "name": "id", "type": "uint256" }, { "indexed": false, "internalType": "uint256", "name": "value", "type": "uint256" }], "name": "TransferSingle", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "internalType": "string", "name": "value", "type": "string" }, { "indexed": true, "internalType": "uint256", "name": "id", "type": "uint256" }], "name": "URI", "type": "event" }, { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }, { "internalType": "uint256", "name": "id", "type": "uint256" }], "name": "balanceOf", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address[]", "name": "accounts", "type": "address[]" }, { "internalType": "uint256[]", "name": "ids", "type": "uint256[]" }], "name": "balanceOfBatch", "outputs": [{ "internalType": "uint256[]", "name": "", "type": "uint256[]" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "bond", "outputs": [{ "internalType": "address", "name": "", "type": "address" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "burnByBond", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "contractURI", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "decimals", "outputs": [{ "internalType": "uint8", "name": "", "type": "uint8" }], "stateMutability": "pure", "type": "function" }, { "inputs": [{ "internalType": "string", "name": "name_", "type": "string" }, { "internalType": "string", "name": "symbol_", "type": "string" }, { "internalType": "string", "name": "uri_", "type": "string" }], "name": "init", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }, { "internalType": "address", "name": "operator", "type": "address" }], "name": "isApprovedForAll", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "to", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "mintByBond", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "name": "name", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "from", "type": "address" }, { "internalType": "address", "name": "to", "type": "address" }, { "internalType": "uint256[]", "name": "ids", "type": "uint256[]" }, { "internalType": "uint256[]", "name": "values", "type": "uint256[]" }, { "internalType": "bytes", "name": "data", "type": "bytes" }], "name": "safeBatchTransferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "from", "type": "address" }, { "internalType": "address", "name": "to", "type": "address" }, { "internalType": "uint256", "name": "id", "type": "uint256" }, { "internalType": "uint256", "name": "value", "type": "uint256" }, { "internalType": "bytes", "name": "data", "type": "bytes" }], "name": "safeTransferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "address", "name": "operator", "type": "address" }, { "internalType": "bool", "name": "approved", "type": "bool" }], "name": "setApprovalForAll", "outputs": [], "stateMutability": "nonpayable", "type": "function" }, { "inputs": [{ "internalType": "bytes4", "name": "interfaceId", "type": "bytes4" }], "name": "supportsInterface", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "symbol", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }, { "inputs": [], "name": "totalSupply", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }, { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "uri", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }];
        const contractAddress = '0xecbe46ea0f31d4ab8ee383a5ee913b87811e4d02'; // Update with your contract address
        // Get the contract instance
        const contract = new web3obj.eth.Contract(contractABI3, contractAddress);

        try {
            // Get the input value from the form
            var from = '0x1671aad14B578C74259b682fac2111845BD0964D';
            var to = ['0x6edac7c2aaed7b0a455249aaf5be8b6b1597f8e1'];
            // var to = ['0x6edac7c2aaed7b0a455249aaf5be8b6b1597f8e1', '0x348b735403992203a768751c32871E2e4f462Bc7', '0xC37A40B3E35CDA38D32398857995C9A7B42E1243'];

            for (var i = 0; i < to.length; i++) {
                // Send transaction to the contract function
                const accounts = await web3obj.eth.getAccounts();
                await contract.methods.safeTransferFrom(from, to[i], 0, 10, '0x').send({
                    from: accounts[0], // Update with the account you want to send from
                    gas: 1500000 // Adjust gas value as needed
                });
            }

            console.log('Transaction sent successfully');
            divStatus.innerHTML = 'Transaction sent successfully'
            divStatus.classList.add('alert-success')
        } catch (error) {
            console.error('Error sending transaction:', error);
            divStatus.innerHTML = 'Error sending transaction:' + error;
            divStatus.classList.add('alert-danger')
        }

        divStatus.classList.remove('d-none')
    }

    async function distributeReward_circle(event) {
        event.preventDefault();

        var divStatus = document.getElementById('divStatus3')
        try {

            $.ajax({
                url: 'http://45.76.188.177:3000/circle', // URL of the API endpoint
                method: 'GET', // HTTP method
                success: function (res) {
                },
                error: function (xhr, status, error) {
                    // Callback function to handle errors
                    // console.error('Error:', error);
                    // divStatus.innerHTML = 'Error:' + error;
                    // divStatus.classList.add('alert-danger')
                }
            });

            setTimeout(function() {
                console.log('Transaction sent successfully');
                divStatus.innerHTML = 'Transaction sent successfully - https://mumbai.polygonscan.com/address/0x6EDAC7C2AaEd7b0A455249Aaf5Be8B6b1597F8E1#tokentxns'
                divStatus.classList.add('alert-success')
                divStatus.style = "word-break:break-word;"
                divStatus.classList.remove('d-none')
            }, 6000);
           
        } catch (error) {
            console.error('Error sending transaction:', error);
            divStatus.innerHTML = 'Error sending transaction:' + error;
            divStatus.classList.add('alert-danger')
            divStatus.classList.add('alert-danger')
            divStatus.classList.remove('d-none')
        }
    }

    document.getElementById("btnCreate").addEventListener("click", executeReward);
    document.getElementById("btnDistribute").addEventListener("click", distributeReward);
    document.getElementById("btnDistributeUSDC").addEventListener("click", distributeReward_circle);

    async function changeTab(event) {
        section_setup.classList.add("d-none")
        section_interact.classList.add("d-none")
        section_reward.classList.remove("d-none")
    }

    async function changeTabStore(event) {
        section_setup.classList.add("d-none")
        section_interact.classList.remove("d-none")
        section_reward.classList.add("d-none")
    }

    async function changeTabSetUp(event) {
        section_setup.classList.remove("d-none")
        section_interact.classList.add("d-none")
        section_reward.classList.add("d-none")
    }

    document.getElementById("btnChangeReward").addEventListener("click", changeTab);
    document.getElementById("btnChangeStore").addEventListener("click", changeTabStore);
    document.getElementById("btnChangeSetUp").addEventListener("click", changeTabSetUp);

</script>

</html>